---
- name: Sabnzbd container
  docker_container:
    state: started
    name: sabnzbd
    image: linuxserver/sabnzbd:latest
    pull: true
    volumes:
      - "{{ configs_dir }}/sabnzbd:/config"
      - "{{ download_dir }}:/downloads"
      - "{{ download_dir}}/incomplete:/incomplete-downloads"
    ports:
      - "127.0.0.1:8010:8080"
    env:
      PUID={{ users.0.uid }}
      PGID=1001
      TZ={{ timezone }}
    restart_policy: always
  tags: sabnzbd

- name: Transmission container
  docker_container:
    state: started
    name: transmission
    image: linuxserver/transmission:latest
    pull: true
    volumes:
      - "{{ configs_dir }}/transmission:/config"
      - "{{ download_dir}}:/downloads"
      - "{{ media_dir }}/watch:/watch"
    ports:
      - "127.0.0.1:9091:9091"
      - "127.0.0.1:51413:51413"
    env:
      PUID={{ users.5.uid }}
      PGID=1001
      TZ={{ timezone }}
    restart_policy: always
  tags: transmission

- name: Hydra container
  docker_container:
    state: started
    name: hydra
    image: linuxserver/hydra:latest
    pull: true
    volumes:
      - "{{ configs_dir }}/hydra:/config"
    ports:
      - "127.0.0.1:5075:5075"
    env:
      PUID={{ users.11.uid }}
      PGID=1001
      TZ={{ timezone }}
    links:
      - "sabnzbd:sabnzbd"
    restart_policy: always
  tags: hydra

- name: Jackett
  docker_container:
    state: started
    name: jackett
    image: linuxserver/jackett:latest
    pull: true
    volumes:
      - "{{ configs_dir }}/jackett:/config"
    ports:
      - "127.0.0.1:9117:9117"
    env:
      PUID={{ users.11.uid }}
      PGID=1001
      TZ={{ timezone }}
      RUN_OPTS=
    restart_policy: always
  tags: jackett

- name: Plex container
  docker_container:
    state: started
    name: plex
    image: plexinc/pms-docker:plexpass
    pull: true
    volumes:
      - "{{ configs_dir }}/plex:/config"
      - "{{ media_dir }}/Videos:/data:ro"
      - "/home/transcode:/transcode"
    ports:
      - "32469:32469"
      - "32400:32400"
      - "32401:32401"
      - "3005:3005"
      - "8324:8324"
      - "1900:1900/udp"
      - "32410:32410/udp"
      - "32412:32412/udp"
      - "32413:32413/udp"
      - "32414:32414/udp"
    env:
      PLEX_CLAIM="claim-MWWps1QYNDksfn2o7sBc"
      ADVERTISE_IP="http://{{ ansible_default_ipv4.address }}:32400/"
      PLEX_UID=111
      PLEX_GID=118
      CHANGE_CONFIG_DIR_OWNERSHIP=true
      TZ={{ timezone }}
    network_mode: host
    restart_policy: always
  tags: plex

- name: Sonarr container
  docker_container:
    state: started
    name: sonarr
    image: linuxserver/sonarr:latest
    pull: true
    volumes:
      - "{{ configs_dir }}/sonarr:/config"
      - "{{ download_dir }}:/downloads"
      - "{{ media_dir }}/Videos/TV:/tv"
      - "/dev/rtc:/rtc:ro"
    ports:
      - "127.0.0.1:8989:8989"
    env:
      PUID={{ users.3.uid }}
      PGID=1001
      TZ={{ timezone }}
    links:
      - "sabnzbd:sabnzbd"
      - "transmission:transmission"
      - "hydra:hydra"
      - "jackett:jackett"
    restart_policy: always
  tags: sonarr

- name: Tautulli container
  docker_container:
    state: started
    name: tautulli
    image: linuxserver/tautulli:latest
    pull: true
    volumes:
      - "{{ configs_dir }}/plexpy:/config"
      - "/etc/localtime:/etc/localtime:ro"
      - "{{ configs_dir}}/plex/Library/Application\ Support/Plex\ Media\ Server/Logs:/logs:ro"
    ports:
      - "127.0.0.1:8283:8181"
    env:
      PUID={{ users.8.uid }}
      PGID=65534
      TZ={{ timezone }}
    restart_policy: always
  tags: plexpy

- name: Radarr
  docker_container:
    state: started
    name: radarr
    image: linuxserver/radarr:latest
    pull: true
    volumes:
      - "{{ configs_dir }}/radarr:/config"
      - "{{ download_dir }}:/downloads"
      - "{{ media_dir }}/Videos/Movies:/movies"
      - "/etc/localtime:/etc/localtime:ro"
    ports:
      - "127.0.0.1:7878:7878"
    env:
      PUID={{ users.1.uid }}
      PGID=1001
      TZ={{ timezone }}
    links:
      - "sabnzbd:sabnzbd"
      - "transmission:transmission"
      - "jackett:jackett"
    restart_policy: always
  tags: radarr

- name: Lidarr
  docker_container:
    state: started
    name: lidarr
    image: linuxserver/lidarr:latest
    pull: true
    volumes:
      - "{{ configs_dir }}/lidarr:/config"
      - "{{ download_dir }}:/downloads"
      - "{{ media_dir }}/Videos/Music:/music"
    ports:
      - "127.0.0.1:8686:8686"
    env:
      PUID={{ users.4.uid }}
      PGID=1001
      TZ={{ timezone }}
    links:
      - "sabnzbd:sabnzbd"
      - "transmission:transmission"
      - "jackett:jackett"
    restart_policy: always
  tags: lidarr

- name: Beets
  docker_container:
    state: started
    name: beets
    image: linuxserver/beets:latest
    pull: true
    volumes:
      - "{{ configs_dir }}/beets:/config"
      - "{{ download_dir }}:/downloads"
      - "{{ media_dir }}/Videos/Music:/music"
    ports:
      - "127.0.0.1:8337:8337"
    env:
      PUID={{ users.12.uid }}
      PGID=1001
      TZ={{ timezone }}
    restart_policy: always
  tags: beets

- name: googlemusic
  docker_container:
    state: started
    name: gmusic
    image: jaymoulin/google-music-uploader:1.4.1
    pull: true
    volumes:
      - "{{ configs_dir }}/gmusic:/root/oauth"
      - "{{ media_dir }}/Videos/Music/Library:/media/library"
    env:
      REMOVE=false
      ONESHOT=false
      UPLOADER_ID={{ ansible_default_ipv4.macaddress|upper }}
      DEDUP_API={{ gmusic_oauth }}
    restart_policy: always
  tags: gmusic

- name: Remove dangling images
  docker_prune:
    images: true
    images_filters:
      dangling: true
